# .BilibiliApi


* Default domain name:
service-6p6n381u-1252139706.hk.apigw.tencentcs.com/release
* 自定义域名：
api.bilibili.love/r


All URIs are relative to *http://service-6p6n381u-1252139706.hk.apigw.tencentcs.com/release*
# SDK document directory
* 1. API list
* 2. API call
   * 2.1 Public participation
   * 2.2 Authentication mode
   * 2.3 API details
* 3. More information
  
# 1. API list

API name | HTTP request method and path | describe
------------- | ------------- | -------------
**getView** | **GET** /view | 


**(If the defined API's request method is any method, the SDK defaults to get method,You can modify the prompt content in client_package/api/*_api.py ,to change the method you want to use)** 

# 2.API call
## 2.1 Public participation
Public input parameter refers to the request parameter that may be used by each interface。

| Parameter name       | Position   | Describe |
| -------------- | ------ |  ---------------------------------------- |
| Date           | Header | HTTP request construction time in GMT format |
| Source         | Header | Device type that initiates the HTTP request |
| Authorization  | Header | When the API is non authentication free, the signature string generated by the key rule or the token parameter in OAuth should be added for identity authentication|
| cookie         | Header | When the authorization API of the business API binding is set as Cookie carrying token, the id_token needs to be added to the cookie of the business API |

## 2.2 Authentication mode
### 2.2.1 Key pair
If the API you call is a key pair verification method, please modify the secretid / secretkey in client_package / API / * _api.py in advance(The default is empty)


### 2.2.2 Oauth2.0
If the API you call is a business API bound with oauth2.0 authentication mode, please call the authorization API bound with the business API first, and construct the authorization parameter through the response information returned by the authorization API.
So what you need to do:
  (1)Get the authorization code from the authentication server(Tencent cloud API gateway does not participate in the authentication process between you and as)
  (2)Call the authorization API bound to the business API. This document will indicate the authorization API associated with each business API. When calling the authorization API, please construct the code parameter(The value of code is the authorization code you obtained through the authentication server)
  (3)The token information returned by the authorization API is used to construct the token parameter when calling the business API
  	The header parameter name corresponding to the token value is cookie or authorization(Determined by the "backend setting token carrying location" when creating authorization API)
	The two header parameter formats are as follows:
	1.cookie='id_token=xxx.xxx.xxx'
	2.authorization='Authorization:Bearer id_token="xxx.xxx.xxx"'


## 2.3 API details

# 
# **API name:getView**
> getView(aid=aid, bVid=bVid)
> returnType:'String' 

## Describe


## Request information
Calling address:http://service-6p6n381u-1252139706.hk.apigw.tencentcs.com/release/view
Method:GET

## Request parameters

Name | Type | Describe  | Must fill  | Default value
------------- | ------------- | ------------- | ------------- | -------------
 **aid** | **Number**|  | 否 | 无
 **bVid** | **String**|  | 否 | 

## Return information

### Return parameter type

**'String'**

### Successful response example
```
{&quot;code&quot;:0,&quot;message&quot;:&quot;0&quot;,&quot;ttl&quot;:1,&quot;data&quot;:{&quot;bvid&quot;:&quot;BV17x411w7KC&quot;,&quot;aid&quot;:170001,&quot;videos&quot;:10,&quot;tid&quot;:193,&quot;tname&quot;:&quot;MV&quot;,&quot;copyright&quot;:2,&quot;pic&quot;:&quot;http://i2.hdslb.com/bfs/archive/1ada8c32a9d168e4b2ee3e010f24789ba3353785.jpg&quot;,&quot;title&quot;:&quot;【MV】保加利亚妖王AZIS视频合辑&quot;,&quot;pubdate&quot;:1320850533,&quot;ctime&quot;:1497380562,&quot;desc&quot;:&quot;sina 保加利亚超级天王 Azis1999年出道。他的音乐融合保加利亚名族曲风chalga和pop、rap等元素，不过他惊艳的易装秀与浮夸的角色诠释才是他最为出名的地方 Azis与众多保加利亚天王天后级歌手都有过合作.06年，他作为Mariana Popova的伴唱，在欧洲半决赛上演唱了他们的参赛曲Let Me Cry 06年他被Velikite Balgari评为保加利亚有史以来最伟大的名人之一&quot;,&quot;state&quot;:0,&quot;attribute&quot;:2130003,&quot;duration&quot;:2412,&quot;rights&quot;:{&quot;bp&quot;:0,&quot;elec&quot;:0,&quot;download&quot;:1,&quot;movie&quot;:0,&quot;pay&quot;:0,&quot;hd5&quot;:0,&quot;no_reprint&quot;:0,&quot;autoplay&quot;:1,&quot;ugc_pay&quot;:0,&quot;is_cooperation&quot;:0,&quot;ugc_pay_preview&quot;:0,&quot;no_background&quot;:0},&quot;owner&quot;:{&quot;mid&quot;:122541,&quot;name&quot;:&quot;冰封.虾子&quot;,&quot;face&quot;:&quot;http://i2.hdslb.com/bfs/face/40c46ee74dd6ea33d46c38cd6083e6a1286aa482.gif&quot;},&quot;stat&quot;:{&quot;aid&quot;:170001,&quot;view&quot;:27709966,&quot;danmaku&quot;:832618,&quot;reply&quot;:132707,&quot;favorite&quot;:695152,&quot;coin&quot;:188980,&quot;share&quot;:509217,&quot;now_rank&quot;:0,&quot;his_rank&quot;:13,&quot;like&quot;:458023,&quot;dislike&quot;:0,&quot;evaluation&quot;:&quot;&quot;},&quot;dynamic&quot;:&quot;&quot;,&quot;cid&quot;:279786,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0},&quot;no_cache&quot;:false,&quot;pages&quot;:[{&quot;cid&quot;:279786,&quot;page&quot;:1,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Хоп&quot;,&quot;duration&quot;:199,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:275431,&quot;page&quot;:2,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Imash li surce&quot;,&quot;duration&quot;:205,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:279787,&quot;page&quot;:3,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;No Kazvam Ti Stiga&quot;,&quot;duration&quot;:308,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:280467,&quot;page&quot;:4,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Samo za teb&quot;,&quot;duration&quot;:273,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:280468,&quot;page&quot;:5,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Tochno sega&quot;,&quot;duration&quot;:241,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:280469,&quot;page&quot;:6,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Kak boli&quot;,&quot;duration&quot;:336,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:274491,&quot;page&quot;:7,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Obicham Te&quot;,&quot;duration&quot;:250,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:267410,&quot;page&quot;:8,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Mrazish&quot;,&quot;duration&quot;:201,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:267714,&quot;page&quot;:9,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Няма накъде&quot;,&quot;duration&quot;:201,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}},{&quot;cid&quot;:270380,&quot;page&quot;:10,&quot;from&quot;:&quot;vupload&quot;,&quot;part&quot;:&quot;Gadna poroda&quot;,&quot;duration&quot;:198,&quot;vid&quot;:&quot;&quot;,&quot;weblink&quot;:&quot;&quot;,&quot;dimension&quot;:{&quot;width&quot;:0,&quot;height&quot;:0,&quot;rotate&quot;:0}}],&quot;subtitle&quot;:{&quot;allow_submit&quot;:false,&quot;list&quot;:[]}}}
```
### Failure response example
```
{&quot;code&quot;:-404,&quot;message&quot;:&quot;啥都木有&quot;,&quot;ttl&quot;:1}
```

## Error code

Error code | Error message&Describe
------------- | -------------
 **200** | OK


## Authentication


## Call DEMOO
```javascript
var Bilibili = require('bilibili');

var apiInstance = new Bilibili.BilibiliApi();

var opts = { 
  'aid': 56, // Number | 
  'bVid': "" // String | 
};

var callback = function(error, data, response) {
  if (error) {
    console.error(error);
  } else {
    console.log('API called successfully. Returned data: ' + data);
  }
};
apiInstance.getView(opts, callback);
```


# 3. More information
## 3.1 Public error

| Error code                                     | http status code | semantics                                       | Solution                                     |
| ---------------------------------------- | ------- | ---------------------------------------- | ---------------------------------------- |
| Not Found Host                           | 404     | Host field is not carried in the request      | The request carries the host field. The value of this field needs to fill in the domain name of the server and is of string type      |
| Get Host Fail                            | 404     | The host field value carried in the request is not of type string     | Change the host field value to string type                       |
| Could not support method                 | 404     | The request method type is not supported                              | Check whether the request method is legal                               |
| There is no api match host[$host]        | 404     | Request server domain name / address not found                        | Check if the request address is correct                              |
| There is no api match env_mapping[%env_mapping] | 404     | Error in Env_mapping field after custom domain name            | Check whether the env_mapping of the bound custom domain name configuration is consistent with the one you filled in       |
| There is no api match default env_mapping[%env_mapping] | 404     | The env_mapping field after the default domain name needs to be test/prepub/release | The env_mapping field after the default domain name needs to be test/prepub/release |
| There is no api match uri[$uri]          | 404     | No API matching the URI was found under the service corresponding to the request address    | Please check whether the URI is filled in correctly                             |
| There is no api match method[$method]    | 404     | The API corresponding to the request address + URI does not support the request method                | Please check whether the request method is correct                              |
| Not allow use HTTPS protocol或者Not allow use HTTP protocol | 404     | The service corresponding to the request address does not support the corresponding HTTP protocol type                 | Please check if the request protocol type is correct                            |
| req is cross origin, api $uri need open cors flag on qcloud apigateway. | 429     | The request is a cross domain request, but the corresponding API does not turn on the cross domain switch  | Please turn on the cross domain switch of the API                             |
| HMAC signature cannot be verified, a validate authorization header is required | 401     | The request does not carry the authorization field               | Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |
| authorization headers is invalidate      | 403     | Request authorization field format is incorrec                   | Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |
| id or signature missing                  | 403     | Request authorization field has no ID or signature field        | Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |
| HMAC signature cannot be verified, a valid $header header is required | 403     | The headers field in the request authorization field cannot be found in the request header | Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |
| HMAC signature cannot be verified, a valid date header is required | 403     | Request authorization must use the date field as one of the authentication fields      | Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |
| Found no validate usage plan             | 403     | Failed to request authentication. The API needs authentication, but the API has no binding plan            | Turn off the authentication of the API or bind the usage plan to the publishing environment where the API is located, and bind the API key to the usage plan |
| HMAC signature cannot be verified        | 403     | Failed to request authentication. The key ID carried in the authorization field is not bound to the publishing environment where the API is located, or the key ID is illegal, or the key is disabled | Please check whether the apikey is available and whether the apikey is bound to the corresponding usage plan / publishing environment    |
| HMAC signature does not match            | 403     | Failed to request authentication. The calculated HMAC value is inconsistent. Please recheck and calculate          | The calculated HMAC value is wrong. Please construct the authorization field according to the chapter of document API authentication, or refer to demo to construct the field |


# 2.secretId/secretkey detailed calculation rules of signature are as follows
In order to protect your API, avoid data loss and asset loss caused by malicious access, unauthorized access, application vulnerability, hacker attack, etc., the API gateway provides [secret_id + secret_key authentication](https://cloud.tencent.com/document/product/628/11819) mode.

You can use secret? ID and secret? Key to manage your API authentication. Secret ID and secret key appear in pairs, which are called secret ID / secret key pairs.

Before using secret_id / secret_key to authenticate, you need to create a pair of secret_id and secret_key in [Tencent cloud API gateway management console] (https://console.cloud.tencent.com/apigateway/key?rid = 1).

When the service publishes and selects the authentication method of the publishing service, you can choose to use secret ﹣ ID + secret ﹣ key authentication, and then select the created secret ﹣ ID / secret ﹣ key pair at the selection of secret ﹣ ID / secret ﹣ key pair.

A pair of secret_id / secret_keys can be used for multiple published services. A published service can also choose to use multiple secret_id / secret_key pairs.

The way to complete the authentication is as follows:

#### secret key content

First, create and prepare a pair of secret keys as follows:

- **secret_id**：for example, AKIDCgOPWjQ6BAxvHtyckhWABJVYSBj548pN 

  It is used to identify which key is used and participate in signature calculation, which is reflected in the transmission process.

- **secret_key**：for example, ZxF2whO0RhuwnVCj5JMMAuqcDcN2oPrC 

  Used for signature calculation, not reflected in the delivery process.

### computing method

#### Final send content

The final HTTP request sent contains at least two headers: * * date * * and * * authorization * *, which can contain more headers.

The value of date header is HTTP request construction time in GMT format, such as Fri, 09 OCT 2015 00:00:00 GMT.

Authorization header form like `Authorization: hmac id="secret_id", algorithm="hmac-sha1", headers="date source", signature="Base64(HMAC-SHA1(signing_str, secret_key))"`。

Now we explain the parts in authorization respectively:

- hmac:Fixed content to identify calculation methods.
- id:Its value is the value of secret_id in the secret key.
- algorithm:The encryption algorithm currently supports hmac-sha1.
- headers:The headers involved in signature calculation are arranged in the order of actual calculation.
- signature:The signature obtained after calculating the signature.

#### Signature calculation method

The signature is divided into two parts and calculated according to the specified encryption algorithm. Take hmac-sha1 algorithm as an example:

**1. Signature content**
First, the signature content is generated. The signature content consists of a custom header. It is recommended that the header contain at least date, which can contain more other headers.

The headers are arranged in order after conversion according to the following requirements:

- The header name is converted to lowercase, followed by the * * ASCII colon character * * and * * ASCII space character * *.
- Then attach the header value.
- If it is not the last header to construct a signature, attach the * * ASCII newline character \ n * *.

For example, there are two headers involved in building signature content:

```
Date:Fri, 09 Oct 2015 00:00:00 GMT
Source:AndriodApp
```

The generated signature content is:

```
date: Fri, 09 Oct 2015 00:00:00 GMT\nsource: AndriodApp
```

**2. Computational signature**
Use the base64 (hmac-sha1 (signing_str, secret_key)) algorithm to calculate the signature content generated in the previous step, that is:

- The signature content is used as the input information, the secret_key content in the key is used as the key, and the hmac-sha1 algorithm is used to calculate the encrypted signature content.

- Use Base64 to transform the calculated encrypted signature content to generate transitive signature content.

**3. Use signature**

  As shown in * final sending content *, fill in the signature of authorization header with the signature after the previous calculation.

### Matters needing attention

#### Header correspondence

In authorization, the need to fill in the headers position is the name of the header participating in the signature calculation, and it is recommended to convert it to lowercase, separated by ASCII spaces.

#### Signature content generation

When arranging content, please pay attention to the colon and space after the header name. If it is lost, the verification may fail.
